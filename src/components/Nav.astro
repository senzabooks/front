---
// Nav.astro
const pathname = Astro.url.pathname;

// Normalize paths (remove trailing slash except for "/")
const cleanPath = (p) => (p === "/" ? "/" : p.replace(/\/+$/, ""));

// Active if exact match or if current path is inside that section (e.g. /blog/post-1)
// Keep Home active only on the homepage
const isActive = (route) => {
  const currentPath = cleanPath(pathname);

  if (route === "/") return currentPath === "/";

  return currentPath === route || currentPath.startsWith(route + "/");
};

// add all to routes
const routes = ["/", "/works", "/about", "/blog"];
---

<ul class="nav-bar" id="navBar" data-routes={JSON.stringify(routes)}>
  <li>
    <a href="/" class:list={{ active: isActive("/") }}>Dzastins Zavadskis</a>
  </li>
  <li>
    <a href="/works" class:list={{ active: isActive("/works") }}>Works</a>
  </li>
  <li>
    <a href="/about" class:list={{ active: isActive("/about") }}>About</a>
  </li>
  <li>
    <a href="/blog" class:list={{ active: isActive("/blog") }}>Blog</a>
  </li>
</ul>

<style lang="scss">
  /* Nav.astro â€” FINAL CSS (full) */

  .nav-bar {
    position: fixed;
    top: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    list-style: none;
    width: max-content;
    padding: 0;
    z-index: 10;
    gap: 12px;
    transition:
      top 0.25s ease,
      opacity 0.25s ease;
      padding-bottom: 80px;
  }

  .nav-bar--hidden {
    top: -80px;
    opacity: 0;
  }

  /* ---------- DEFAULT (raised) ---------- */
  .nav-bar li {
    position: relative;
    background: var(--pill-bg);
    backdrop-filter: var(--backdrop-filter);
    -webkit-backdrop-filter: var(--backdrop-filter);
    border-radius: var(--br);
    transition: backdrop-filter 0.15s ease;
  }

  .nav-bar a {
    padding: 0px 14px 2.5px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #000;
    text-decoration: none;
    white-space: nowrap;
    position: relative;
    z-index: 1;
    border-radius: var(--br);

    /* raised */
    box-shadow: var(--box-shadow);
    transition:
      box-shadow 0.15s ease,
      color 0.15s ease;
  }

  /* pill background (hover + active) */
  .nav-bar a::before {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: var(--br);
    z-index: -1;
    opacity: 0;
    transition: opacity 0.15s ease;
  }

  /* active pill default */
  .nav-bar a.active::before {
    opacity: 1;
  }

  /* ---------- PRESSED-IN STATES ---------- */
  /* active stays pressed in */
  .nav-bar a.active {
    box-shadow: 0 0 3px rgba(122, 122, 122, 0.4) inset;
  }
  .nav-bar li:has(a.active) {
    background: rgba(255, 255, 255, 0.65);
  }

  /* =========================================================
   HOVER CAPABLE DEVICES ONLY (mouse/trackpad)
   Prevents sticky :hover problems on touch
   ========================================================= */
  @media (hover: hover) and (pointer: fine) {
    /* show pill on hover */
    .nav-bar li:hover a::before {
      opacity: 1;
    }

    /* when hovering the nav, hide active pill (so only hovered shows) */
    .nav-bar:hover a.active::before {
      opacity: 0;
    }

    /* but if hovering the active item itself, show it */
    .nav-bar:hover li:hover a.active::before {
      opacity: 1;
    }

    /* hovered item becomes pressed in */
    .nav-bar li:hover a {
      box-shadow: 0 0 3px rgba(122, 122, 122, 0.4) inset;
    }

    .nav-bar li:hover {
      backdrop-filter: var(--backdrop-filter-pressed);
      -webkit-backdrop-filter: var(--backdrop-filter-pressed);
    }
  }

  /* =========================================================
   TOUCH DEVICES
   Make hover effects non-sticky; use :active for press
   ========================================================= */
  @media (hover: none) and (pointer: coarse) {
    /* never hide the active pill on touch */
    .nav-bar:hover a.active::before {
      opacity: 1;
    }

    /* cancel any sticky hover press-in */
    .nav-bar li:hover a {
      box-shadow: var(--box-shadow);
    }
    .nav-bar li:hover {
      backdrop-filter: var(--backdrop-filter);
      -webkit-backdrop-filter: var(--backdrop-filter);
    }
    .nav-bar li:hover a::before {
      opacity: 0;
    }

    /* show press only while finger is down */
    .nav-bar li:active a {
      box-shadow: 0 0 3px rgba(122, 122, 122, 0.4) inset;
    }
    .nav-bar li:active {
      backdrop-filter: var(--backdrop-filter-pressed);
      -webkit-backdrop-filter: var(--backdrop-filter-pressed);
    }

    /* keep active pill visible on touch */
    .nav-bar a.active::before {
      opacity: 1;
    }
  }

  /* stack navigation */
@media (max-width: 560px) {
  .nav-bar {
    flex-wrap: wrap;
    justify-content: center;
    row-gap: 10px;
    column-gap: 10px;

    /* keep the wrapped nav centered as a block */
    width: min(320px, calc(100vw - 24px));
  }

  .nav-bar li {
    flex: 0 0 auto;
  }
}
</style>